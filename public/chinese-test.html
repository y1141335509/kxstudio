<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>中文编码测试</title>
    <style>
        body {
            font-family: "Microsoft YaHei", "SimHei", "黑体", Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
            line-height: 1.6;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .chinese-text {
            font-size: 18px;
            color: #333;
            padding: 10px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            margin: 10px 0;
        }
        .encoding-info {
            font-family: monospace;
            background: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>🇨🇳 中文编码检测和修复</h1>
    
    <div class="test-section">
        <h3>测试文本：</h3>
        <div class="chinese-text">
            🍉 切西瓜游戏 - 平衡饥饿度和血糖！
        </div>
        <div class="chinese-text">
            游戏操作：鼠标滑动切割西瓜 | 空格键暂停 | 挑战你的生存技巧
        </div>
        <div class="chinese-text">
            特殊西瓜：金色西瓜、甜味西瓜、迷你西瓜、巨型西瓜
        </div>
    </div>

    <div class="test-section">
        <h3>编码信息：</h3>
        <div class="encoding-info" id="encodingInfo">检测中...</div>
    </div>

    <div class="test-section">
        <h3>修复建议：</h3>
        <div id="fixSuggestions">生成中...</div>
    </div>

    <div class="test-section">
        <h3>Godot 游戏链接测试：</h3>
        <p>点击下面的链接测试游戏中的中文显示：</p>
        <a href="/games/watermelon/" target="_blank" style="
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 6px;
            margin-right: 10px;
        ">🎮 打开游戏测试中文</a>
    </div>

    <script>
        // 检测编码信息
        function detectEncoding() {
            const info = {
                charset: document.characterSet || document.charset,
                contentType: document.contentType,
                documentElement: document.documentElement.lang,
                userAgent: navigator.userAgent,
                platform: navigator.platform
            };
            
            document.getElementById('encodingInfo').innerHTML = `
                <strong>文档字符集:</strong> ${info.charset}<br>
                <strong>内容类型:</strong> ${info.contentType}<br>
                <strong>文档语言:</strong> ${info.documentElement}<br>
                <strong>用户代理:</strong> ${info.userAgent}<br>
                <strong>平台:</strong> ${info.platform}
            `;
            
            return info;
        }

        // 生成修复建议
        function generateFixSuggestions(info) {
            let suggestions = [];
            
            if (info.charset !== 'UTF-8') {
                suggestions.push('❌ 字符集不是 UTF-8，建议修改为 UTF-8');
            } else {
                suggestions.push('✅ 字符集正确 (UTF-8)');
            }
            
            suggestions.push('<strong>对于 Godot 游戏中文乱码的修复方法：</strong>');
            suggestions.push('1. 确保 Godot 项目中所有 .gd 脚本文件以 UTF-8 编码保存');
            suggestions.push('2. 在 Godot 项目设置 → 本地化 → 语言 设为 "zh_CN"');
            suggestions.push('3. 检查导出的 index.html 文件头部是否包含正确的 meta 标签');
            suggestions.push('4. 确保 Web 服务器返回正确的 Content-Type 头部');
            
            suggestions.push('<strong>如果问题仍然存在：</strong>');
            suggestions.push('• 在 Godot 编辑器中：编辑器设置 → 网络 → 调试 → 远程端口 设为合适值');
            suggestions.push('• 重新导出游戏时，选择 "调试" 模式而不是 "发布" 模式');
            suggestions.push('• 检查 vercel.json 是否包含正确的 Content-Type 头部');
            
            document.getElementById('fixSuggestions').innerHTML = suggestions.map(s => 
                s.startsWith('•') || s.startsWith('❌') || s.startsWith('✅') || /^\d+\./.test(s) 
                    ? `<div style="margin: 5px 0; padding-left: 20px;">${s}</div>`
                    : `<div style="margin: 10px 0; font-weight: bold;">${s}</div>`
            ).join('');
        }

        // 执行检测
        const encodingInfo = detectEncoding();
        generateFixSuggestions(encodingInfo);

        // 测试中文字符的字节表示
        const testText = "切西瓜游戏";
        console.log('中文测试字符:', testText);
        console.log('字符长度:', testText.length);
        console.log('字节表示:', new TextEncoder().encode(testText));
    </script>
</body>
</html>